<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Cursos</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/estilos/admin.css">
    <link rel="stylesheet" href="/estilos/index.css">
    <link rel="stylesheet" href="/estilos/fichacursos.css">
    
    <!-- JS -->
    <script src="/js/cursosAnonimo.js" defer></script>
    <script src="/js/modal.js"></script>

   <!-- Fontawesome -->
   <script src="https://kit.fontawesome.com/7a779ca8ce.js" crossorigin="anonymous"></script>

   <!-- Enlace al favicon -->
   <link rel="icon" type="image/png" href="/imagenes/favicon.png">
</head>
<body>
    <!-- Encabezado con imagen -->
    <div class="header">
        <img src="/imagenes/header/Header Proyecto.jpg" alt="Imagen de encabezado">
    </div>
    <nav>
        <ul>
            <li><a href="/usuarios/html/anonimo/indexAnonimo.html" title="Inicio"><i class="fas fa-home"></i> Inicio</a></li>
            <li><a href="/usuarios/html/anonimo/listaCursosAnonimo.html" title="Catálogo"><i class="fas fa-book-open"></i> Catálogo</a></li>
            <li><a href="/usuarios/html/anonimo/contacto.html" title="Contacto"><i class="fas fa-phone"></i> Contacto</a></li>
            <li><a href="#" class="login" id="abrirModal"><i class="fas fa-user-lock"></i> Iniciar sesión</a></li>
        </ul>
    </nav>

    <!-- Contenedor para bienvenida -->
    <div class="testimonios">
        <div class="testimonio">
            <h2><i class="fas fa-book-open"></i> Bienvenido al Catálogo de Cursos de SkillTech</h2>
            <p>Explora nuestra selección de cursos expertamente diseñados para ayudarte a alcanzar tus metas de aprendizaje. Desde desarrollo web y programación hasta seguridad y tecnologías emergentes, tenemos todo lo que necesitas para potenciar tus habilidades y avanzar en tu carrera. ¡Comienza tu viaje de aprendizaje hoy mismo!</p>

        </div>
    </div>
    
    <!-- Contenedor para las fichas de los cursos --> 
    <div class="cursos-container">
        <section class="info-cursos"></section>
    </div>

    <!-- Ventana modal de inicio de sesión -->
    <div id="modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="registro-div">
                <!-- formulario -->
                <form id="registro" class="form">
                    <h2 class="title2"><img src="/imagenes/LogoHeader.png" alt="Icono de la aplicación"> Bienvenid@</h2>
                    <span class="close" id="cerrarModal">&times;</span>
                    <!-- Campo Nombre -->
                    <div class="inputContainer">
                        <input type="text" id="usuario" class="input" name="usuario" required>
                        <label for="usuario" id="labelUsuario" class="label">Usuario:</label>
                    </div>

                    <!-- Campo Contraseña -->
                    <div class="inputContainer">
                        <input type="password" id="contrasena" class="input" name="contrasena" required>
                        <label for="password" id="labelPassword" class="label">Contraseña:</label>
                    </div>
                                                
                    <!-- Enlace a la página de registro -->
                    <p>¿No tienes una cuenta? <a href="#" id="mostrarRegistro">Regístrate</a></p>
                    
                    <!-- Botón de registro -->
                    <button type="submit" class="botonEnviar"><i class="fas fa-sign-in-alt"></i> Entrar</button>

                    <!-- Mensaje de error -->
                    <p class="mensaje-error" id="mensajeError" style="display: none; color: #ff5b5b;"><i class="fas fa-exclamation-circle"></i> Usuario o contraseña incorrectos. Por favor, inténtalo de nuevo.</p>
                </form>
            </div>
        </div>
    </div>

    <!-- Ventana modal de registro -->
    <div id="modalRegistro" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="registro-div">
                <!-- Formulario de registro -->
                <form id="registro2" class="form">
                    <h2 class="title2"><img src="/imagenes/LogoHeader.png" alt="Icono de la aplicación"> Regístrate</h2>
                    <span class="close" id="cerrarModal2">&times;</span>
                    
                    <!-- Campo Nombre -->
                    <div class="inputContainer">
                        <input type="text" id="nombre" class="input" name="nombre" required>
                        <label for="nombre" id="labelNombre" class="label">Nombre:</label>
                    </div>
                    
                    <!-- Campo Apellidos -->
                    <div class="inputContainer">
                        <input type="text" id="apellidos" class="input" name="apellidos" required>
                        <label for="apellidos" id="labelApellidos" class="label">Apellidos:</label>
                    </div>
                    
                    <!-- Campo Correo -->
                    <div class="inputContainer">
                        <input type="email" id="correo" class="input" name="correo" required>
                        <label for="correo" id="labelCorreo" class="label">Correo:</label>
                    </div>
                    
                    <!-- Campo Contraseña -->
                    <div class="inputContainer">
                        <input type="password" id="password" class="input" name="password" required>
                        <label for="password" id="labelPass" class="label">Contraseña:</label>
                    </div>
                    
                    <!-- Campo oculto para idrol -->
                    <input type="hidden" class="input" id="idrol" name="idrol" value="2">

                    <!-- Botón de registro -->
                    <button type="submit" class="botonRegistro"><i class="fas fa-user-plus"></i> Registrarse</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de bienvenida para administrador -->
    <div id="bienvenidaModalAdmin" class="modal bienvenida-modal">
        <div class="modal-content">
            <h2><i class="fas fa-user-shield icon"></i> Bienvenid@ de nuevo<span id="nombreUsuarioAdmin"></span></h2>
            <p>¡Hola administrador!</p>
        </div>
    </div>

    <!-- Modal de bienvenida para usuario registrado -->
    <div id="bienvenidaModalRegistrado" class="modal bienvenida-modal">
        <div class="modal-content">
            <h2><i class="fas fa-user icon"></i> Bienvenid@ de nuevo <span id="nombreUsuarioRegistrado"></span></h2>
            <p>¡Es genial verte aquí!</p>
        </div>
    </div>
    <!-- Modal de bienvenida para usuario registrado -->
    <div id="bienvenidaModalRegistro" class="modal bienvenida-modal" style="display: none;">
        <div class="modal-content">
            <h2><i class="fas fa-user-check icon"></i> Bienvenid@ <span id="nombreUsuarioRegistradoo"></span></h2>
            <p>Gracias por unirte a nosotros.</p>
            <p id="registroExitosoMessage" style="display: none; color: green;">¡Te has registrado correctamente!</p>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-column">
            <h3><img src="/imagenes/icono.png" alt="SkillTech Logo" class="logo">SkillTech</h3>
            <p>Bienvenido al mundo de los cursos de informática. Descubre tendencias, adquiere habilidades prácticas y mantente actualizado. Explora cursos exclusivos y avanza en tu camino hacia la maestría informática.</p>
        </div>
        <div class="footer-column">
            <h3><i class="fas fa-map-marker-alt"></i> Localización</h3>
            <p>Avenida La Costa, 25<br>33202 Gijón, Asturias<br>España</p>
        </div>
        <div class="footer-column">
            <h3 class="contact-heading"><i class="fas fa-phone"></i> Contacto</h3>
            <p class="phone-icon"><i class="fas fa-mobile-alt"></i> +34 653 111 222</p>
            <p><i class="fas fa-envelope"></i> SkillTech@mail.com</p>
            <p><i class="fab fa-facebook"></i> www.facebook.com</p>
        </div>
    </footer>
    <!-- Script para manejar el LOGIN -->
    <script>
        document.querySelector("#registro").addEventListener('submit', function(event) {
            event.preventDefault();
            // Obtener los valores del formulario
            var nombreUsuario = document.querySelector('#usuario').value;
            var clave = document.querySelector('#contrasena').value;

            // Realizar la solicitud Fetch
            fetch('https://skilltechback-42717f57a83b.herokuapp.com/usuarios/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombreUsuario: nombreUsuario, clave: clave })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error al iniciar sesión');
                }
                return response.json();
            })
            .then(data => {
                // Almacenar el token JWT y el ID de usuario en localStorage
                localStorage.setItem('token', data.token);
                localStorage.setItem('idUsuario', data.idUsuario);

                // Obtener el nombre de usuario
                var nombreUsuario = data.nombreUsuario;
                // Mostrar el nombre de usuario solo para el usuario registrado
                var nombreUsuarioRegistradooElement = document.querySelector('#nombreUsuarioRegistradoo');
                
                if (nombreUsuarioRegistradooElement) {
                    nombreUsuarioRegistradooElement.textContent = nombreUsuario;
                } else {
                    console.error('Elemento de nombre de usuario no encontrado en el DOM.');
                }
                // Redireccionar según EL ROL DEL USUARIO
                if (data.rol === 'ADMINISTRADOR') {
                    document.querySelector('#bienvenidaModalAdmin').style.display = 'block';
                    // Redireccionar 
                    setTimeout(function() {
                        window.location.href = '/usuarios/html/admin/indexAdmin.html';
                    }, 3000);
                } else if (data.rol === 'REGISTRADO') {
                    document.querySelector('#bienvenidaModalRegistrado').style.display = 'block';
                    // Redireccionar 
                    setTimeout(function() {
                        window.location.href = '/usuarios/html/registrado/indexRegistrado.html';
                    }, 3000);
                } else {
                    console.error('Rol de usuario desconocido');
                }
            })
            .catch(error => {
                // Mostrar mensaje de error
                document.querySelector('#mensajeError').style.display = 'block';
                console.error('Error:', error);
            });
        });

    </script>


     <!-- Script para REGISTRAR un usuario en la BBDD desde el formulario de registro -->
<script>
    document.querySelector("#registro2").addEventListener('submit', function(event) {
        event.preventDefault();

        // Obtener los valores del formulario
        const nombre = document.querySelector('#nombre').value;
        const apellidos = document.querySelector('#apellidos').value;
        const correo = document.querySelector('#correo').value;
        const password = document.querySelector('#password').value;
        const rol = "REGISTRADO";

        // Verificar que los campos no estén vacíos
        if (nombre === '' || apellidos === '' || correo === '' || password === '') {
            console.error('Por favor, complete todos los campos.');
            return;
        }

        // Crear un objeto JSON con los datos del usuario
        const usuario = {
            nombre,
            apellidos,
            correo,
            password,
            rol
        };

        // Realizar la solicitud Fetch
        fetch('https://skilltechback-42717f57a83b.herokuapp.com/usuarios/insertar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(usuario)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Error al registrar el usuario');
            }
            return response.json();
        })
        .then(data => {
            // Mostrar la ventana modal de bienvenida para el usuario registrado
            const nombreUsuarioRegistradoElement = document.querySelector('#nombreUsuarioRegistradoo');
            if (nombreUsuarioRegistradoElement) {
                nombreUsuarioRegistradoElement.textContent = nombre;
            } else {
                console.error('Elemento nombreUsuarioRegistrado no encontrado en el DOM.');
            }
            document.querySelector('#bienvenidaModalRegistro').style.display = 'block';
            
            // Mostrar mensaje de registro exitoso
            document.querySelector('#registroExitosoMessage').style.display = 'block';
            setTimeout(() => {
                document.querySelector('#registroExitosoMessage').style.display = 'none';
                document.querySelector('#bienvenidaModalRegistro').style.display = 'none';
                // Cerrar la ventana modal de registro y abrir la ventana modal de login
                const modalRegistro = document.querySelector('#modalRegistro');
                const modalLogin = document.querySelector('#modalLogin');
                if (modalRegistro) {
                    modalRegistro.style.display = 'none';
                }
                if (modalLogin) {
                    modalLogin.style.display = 'block';
                }
            }, 3000);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
</script>
    <!-- Script para que giren las fichas de los cursos -->
    <script>
        function rotarFicha(button) {
        const rotateContainer = button.closest(".rotate-container");
        rotateContainer.children[0].classList.toggle("rotar-ficha-back");
        rotateContainer.children[1].classList.toggle("rotar-ficha-front");
    }
    function volverFicha(button) {
        const rotateContainer = button.closest(".rotate-container");
        rotateContainer.children[0].classList.toggle("rotar-ficha-back");
        rotateContainer.children[1].classList.toggle("rotar-ficha-front");
    }
    </script> 
    <script>
        // Obtener la URL de la página actual
        var currentPage = window.location.pathname;
        var menuLinks = document.querySelectorAll('nav ul li a');
    
        // Iterar sobre cada enlace del menú
        for (var link of menuLinks) {
            var linkURL = link.getAttribute('href'); // Obtener la URL del enlace
    
            if (currentPage === linkURL) {
                link.classList.add('activo');
            }
        }
    </script>
    </body>
    </html>